// version 1.1 RUS

function createSelect(msg, items, selectedItemIndex){
  selectedItemIndex = selectedItemIndex || 0

  var accessory = [[NSPopUpButton alloc] initWithFrame:NSMakeRect(0,0,200,25)]
  [accessory addItemsWithTitles:items]
  [accessory selectItemAtIndex:selectedItemIndex]

  var alert = [[NSAlert alloc] init]
  [alert setMessageText:msg]
  [alert addButtonWithTitle:'–ì–æ—Ç–æ–≤—ä']
  [alert addButtonWithTitle:'–ù–µ –≥–æ—Ç–æ–≤—ä']
  [alert setInformativeText: "–ë–µ—Ä–∏ –≤—Å—ë, —á—Ç–æ —Ç–≤–æ—ë"]
  [alert setAccessoryView:accessory]

  var responseCode = [alert runModal]
  var sel = [accessory indexOfSelectedItem]

  btnSelect(alert, responseCode, sel)

  return [sel]
}

var doc = context.document
var minutes = ['5 –º–∏–Ω—É—Ç', '10 –º–∏–Ω—É—Ç', '20 –º–∏–Ω—É—Ç', '30 –º–∏–Ω—É—Ç', '40 –º–∏–Ω—É—Ç']
var options = ['üò± ' + minutes[0], 'üí™ ' + minutes[1], 'üëå ' + minutes[2], 'üëç ' + minutes[3], 'üê¢ ' + minutes[4]]
var choice = createSelect('–ö–∞–∫ –¥–æ–ª–≥–æ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –µ—Ä—É–Ω–¥–æ–π?',options, 2)
var timeOverVal

coscript.setShouldKeepAround(true)

function timeOver(msg, infoMsg) {
  var EndTimeAlert = [[NSAlert alloc] init]
  EndTimeAlert.setMessageText(msg);
  EndTimeAlert.setInformativeText(infoMsg);
  [EndTimeAlert runModal];
}

function btnSelect(alert, responseCode, sel) {
  if (responseCode == "1000") {
    if(sel == 0){
      timeOverVal = "5 minutes"
      doc.displayMessage('5 –º–∏–Ω—É—Ç! –°–æ–π–¥—ë—Ç!');
      coscript.scheduleWithInterval_jsFunction(300, onInterval);
    }
    else if(sel == 1){
      timeOverVal = "10 minutes"
      doc.displayMessage('10 –º–∏–Ω—É—Ç! –≠—Ç–æ —É–∂–µ —É—Å–ø–µ—Ö');
      coscript.scheduleWithInterval_jsFunction(600, onInterval);
    }
    else if(sel == 2){
      timeOverVal = "20 minutes"
      doc.displayMessage('20 –º–∏–Ω—É—Ç! –¢–≤–æ—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–∏–Ω–∏–º—É–º –Ω–∞ —Å–µ–≥–æ–¥–Ω—è');
      coscript.scheduleWithInterval_jsFunction(1200, onInterval);
    }
    else if(sel == 3){
      timeOverVal = "30 –º–∏–Ω—É—Ç! –û—Å—Ç—ã–Ω—å, –±—Ä–æ–¥—è–≥–∞!"
      doc.displayMessage('30 minutes');
      coscript.scheduleWithInterval_jsFunction(1800, onInterval);
    }
    else if(sel == 4){
      timeOverVal = "40 minutes"
      doc.displayMessage('40 –º–∏–Ω—É—Ç... –õ—É—á—à–∏–π');
      coscript.scheduleWithInterval_jsFunction(2400, onInterval);
    }
  }
  else if(responseCode == "1001") {
    doc.displayMessage('–î–æ–±—Ä–µ —Å—ã–Ω–∫—É');
  }
}

function onInterval () {
  timeOver( timeOverVal + " –ù–∞–≥—Ä–∞–¥–∞ –∂–¥—ë—Ç —Ç–µ–±—è", "—Å—ã–Ω–æ–∫ :(")
}
